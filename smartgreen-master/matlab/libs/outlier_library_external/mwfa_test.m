function [] = mwfa_test()
%
% The Moving Window Filtering Algorithm, 'mwfa', is an outlier detection
% method in which a neighborhood of observations, called a filtering
% window, is used to assess the validity of a new observation on the basis
% of its relative distance from the closest neighborhood. Its
% implementation is similar to the Z-score but with moving mean and standard
% deviations. Also, it is possible to calibrate three parameters ('k','alpha',
% 'gamma') to the data set.
%
% Data in 'x' are organized so that columns are the time series and rows
% are the time intervals. All series contain the same number of
% observations.
%
% 'x_date' is a column vector (cell array) containing the dates of the
% corresponding data in 'x'.
%
% 'k' is the window for the moving average and moving standard deviation.
% It is a numerical value indicating the number of lags.
%
% 'alpha' indicates the number of standard deviations that an observation
% should be higher/lower than the moving average to be considered as
% outlier.
%
% 'alpha' specifies the significant level. By default 'alpha' = 0.05.
%
% 'gamma' is a parameter to avoid zero variances produced by sequences of
% 'k' equal values.
%
% [] = mwfa_test() returns a message in the Command Window saying if the
% tests passed or there was some problem during execution.
%
% Created by Francisco Augusto Alcaraz Garcia
%            alcaraz_garcia@yahoo.com
%
% References:
%
% 1) J.M.Puigvert Gutierrez; J.F. Gregori (2008). Clustering Techniques
% Applied to Outlier Detection of Financial Market Series Using a Moving
% Window Filtering Algorithm. ECB Working Paper Series, n. 948, October.
% 
% 2) C.T. Brownlees; G.M. Gallo (2006). Financial Econometric Analysis at
% Ultra-High Frequency: Data Handling Concerns. Computational Statistics
% & Data Analysis 51, pp. 2232-2245.


% Test sample.
% INPUTS:
x = [0.3620;0.3800;0.3160;0.3430;0.3180;0.3280;0.2870;0.2640;0.2490;0.2130;
    0.1630;0.1460;0.1980;0.1150;0.1080;0.1400;0.1540;0.1190;0.1890;0.2500;
    0.3980;0.3570;0.3880;0.3000;0.2730;0.2690;0.2470;0.2440;0.2570;0.2130;
    0.2200;0.1700;0.1940;0.2710;0.2380;0.2160;0.2160;0.2160;0.2610;0.2870;
    0.2670;0.2670;0.3110;0.2990;0.3280;0.3480;0.3960;0.4250;0.4620;0.5950;
    0.5710;0.6860;0.7000;0.7160;0.8750;0.9470;1.1050;1.0500;0.9530;0.9430;
    0.9380;0.8490;0.9010;0.8850;0.8620;0.7880;0.7580;0.7590;0.7260;0.7760;
    0.9260;0.9540;1.0220;1.1470;1.2330;1.1710;1.0280;1.0270;1.0360;1.1840;
    1.1220;1.3110;1.3210;1.3240;1.3030;1.2830;1.2840;1.3500;1.3690;1.3450;
    1.2460;1.2630;1.2130;1.1640;1.1610;1.1390;1.1560;1.0650;1.0340;1.0440;
    1.0280;1.0070;1.0340;1.1240;1.1180;1.1130;1.0700;0.9870;0.9190;0.9580;
    0.9850;0.9630;0.9630;0.9630;0.9790;0.9930;0.9990;0.9760;1.0030;1.0220;
    1.0160;0.9160;0.9270;0.9340;0.9480;0.9240;0.8890;0.8700;0.7540;0.7260;
    0.7170;0.6320;0.5870;0.6360;0.6900;0.7670;0.7790;0.6450;0.7010;0.6770;
    0.6430;0.6850;0.7450;0.6790;0.7410;0.6970;0.6900;0.6960;0.6890;0.6810;
    0.7440;0.7920;0.7380;0.7750;0.8080;0.7880;0.7370;0.7240;0.7400;0.7380;
    0.7280;0.7220;0.7290;0.7470;0.7460;0.7390;0.7750;0.7810;0.7770;0.7740;
    0.7640;0.7660;0.7590;0.7690;0.7590;0.7920;0.7500;0.7590;0.7520;0.7220;
    0.6970;0.6860;0.7150;0.6090;0.5940;0.5610;0.5560;0.4990;0.4680;0.4810;
    0.4290;0.4360;0.4430;0.4330;0.4090;0.4010;0.4400;0.4060;0.3890;0.4090;
    0.4580;0.4320;0.4820;0.4780;0.4360;0.4610;0.4590;0.4330;0.4310;0.4470;
    0.4610;0.4320;0.4820;0.4770;0.5190;0.5630;0.5760;0.5660;0.5750;0.5460;
    0.4890;0.4560;0.4850;0.4750;0.4620;0.4380;0.4490;0.4100;0.4570;0.4330;
    0.4340;0.4080;0.4050;0.4360;0.4230;0.4690;0.5130;0.4910;0.4680;0.4400;
    0.4630;0.4590;0.4520;0.4660;0.4790;0.4600;0.4800;0.4310;0.4190;0.4010;
    0.3510;0.3350;0.3580;0.3480;0.3620;0.3580;0.3660;0.3580;0.3420;0.3120;
    0.3140;0.3120;0.3280;0.3260;0.3390;0.3220;0.3190;0.3310;0.3480;0.3610;
    0.3600;0.4260;0.3950;0.4030;0.4060;0.4040;0.4450;0.4410;0.4120;0.4130;
    0.3860;0.4120;0.3570;0.4200;0.4700;0.5610;0.5610;0.5220;0.5020;0.5140;
    0.4910;0.5530;0.6180;0.6480;0.5750;0.5470;0.5470;0.5470;0.5470;0.5170;
    0.5520;0.5810;0.5820;0.5930;0.5930;0.5790;0.5980;0.6130;0.6890;0.7710;
    0.8090;0.8290;0.8220;0.9510;0.9140;0.9300;0.8430;0.8060;0.8920;1.1010;
    1.0620;1.0570;1.1530;1.3310;1.4450;1.4450;1.4710;1.2620;1.1620;1.0900;
    1.1060;1.1200;1.0990;1.0970;1.0840;1.0310;1.0410;1.1150;1.1150;1.1660;
    1.1140;1.0140;0.9350;0.8850;0.9480;0.9370;0.9260;0.9710;0.8800;0.8710;
    0.8570;0.8890;0.9050;0.9610;0.9610;1.0070;1.0580;1.0570;1.0270;1.0600;
    0.9630;0.9580;0.9760;0.9460;0.9110;0.9110;0.9110;0.9130;1.0010;1.0600;
    1.0220;1.0300;1.0720;1.1300;1.0970;1.2120;1.3370;1.3270;1.4150;1.6540;
    1.6890;1.6890;2.2640;2.4320;2.0590;1.8860;2.0110;2.4000;2.7820;2.5410;
    2.5410;1.5710;1.4700;1.4040;1.4630;1.6200;1.6160];
x_date = {'05/11/2008';'06/11/2008';'07/11/2008';'10/11/2008';'11/11/2008';
    '12/11/2008';'13/11/2008';'14/11/2008';'17/11/2008';'18/11/2008';'19/11/2008';
    '20/11/2008';'21/11/2008';'24/11/2008';'25/11/2008';'26/11/2008';'27/11/2008';
    '28/11/2008';'01/12/2008';'02/12/2008';'03/12/2008';'04/12/2008';'05/12/2008';
    '08/12/2008';'09/12/2008';'10/12/2008';'11/12/2008';'12/12/2008';'15/12/2008';
    '16/12/2008';'17/12/2008';'18/12/2008';'19/12/2008';'22/12/2008';'23/12/2008';
    '24/12/2008';'25/12/2008';'26/12/2008';'29/12/2008';'30/12/2008';'31/12/2008';
    '01/01/2009';'02/01/2009';'05/01/2009';'06/01/2009';'07/01/2009';'08/01/2009';
    '09/01/2009';'12/01/2009';'13/01/2009';'14/01/2009';'15/01/2009';'16/01/2009';
    '19/01/2009';'20/01/2009';'21/01/2009';'22/01/2009';'23/01/2009';'26/01/2009';
    '27/01/2009';'28/01/2009';'29/01/2009';'30/01/2009';'02/02/2009';'03/02/2009';
    '04/02/2009';'05/02/2009';'06/02/2009';'09/02/2009';'10/02/2009';'11/02/2009';
    '12/02/2009';'13/02/2009';'16/02/2009';'17/02/2009';'18/02/2009';'19/02/2009';
    '20/02/2009';'23/02/2009';'24/02/2009';'25/02/2009';'26/02/2009';'27/02/2009';
    '02/03/2009';'03/03/2009';'04/03/2009';'05/03/2009';'06/03/2009';'09/03/2009';
    '10/03/2009';'11/03/2009';'12/03/2009';'13/03/2009';'16/03/2009';'17/03/2009';
    '18/03/2009';'19/03/2009';'20/03/2009';'23/03/2009';'24/03/2009';'25/03/2009';
    '26/03/2009';'27/03/2009';'30/03/2009';'31/03/2009';'01/04/2009';'02/04/2009';
    '03/04/2009';'06/04/2009';'07/04/2009';'08/04/2009';'09/04/2009';'10/04/2009';
    '13/04/2009';'14/04/2009';'15/04/2009';'16/04/2009';'17/04/2009';'20/04/2009';
    '21/04/2009';'22/04/2009';'23/04/2009';'24/04/2009';'27/04/2009';'28/04/2009';
    '29/04/2009';'30/04/2009';'01/05/2009';'04/05/2009';'05/05/2009';'06/05/2009';
    '07/05/2009';'08/05/2009';'11/05/2009';'12/05/2009';'13/05/2009';'14/05/2009';
    '15/05/2009';'18/05/2009';'19/05/2009';'20/05/2009';'21/05/2009';'22/05/2009';
    '25/05/2009';'26/05/2009';'27/05/2009';'28/05/2009';'29/05/2009';'01/06/2009';
    '02/06/2009';'03/06/2009';'04/06/2009';'05/06/2009';'08/06/2009';'09/06/2009';
    '10/06/2009';'11/06/2009';'12/06/2009';'15/06/2009';'16/06/2009';'17/06/2009';
    '18/06/2009';'19/06/2009';'22/06/2009';'23/06/2009';'24/06/2009';'25/06/2009';
    '26/06/2009';'29/06/2009';'30/06/2009';'01/07/2009';'02/07/2009';'03/07/2009';
    '06/07/2009';'07/07/2009';'08/07/2009';'09/07/2009';'10/07/2009';'13/07/2009';
    '14/07/2009';'15/07/2009';'16/07/2009';'17/07/2009';'20/07/2009';'21/07/2009';
    '22/07/2009';'23/07/2009';'24/07/2009';'27/07/2009';'28/07/2009';'29/07/2009';
    '30/07/2009';'31/07/2009';'03/08/2009';'04/08/2009';'05/08/2009';'06/08/2009';
    '07/08/2009';'10/08/2009';'11/08/2009';'12/08/2009';'13/08/2009';'14/08/2009';
    '17/08/2009';'18/08/2009';'19/08/2009';'20/08/2009';'21/08/2009';'24/08/2009';
    '25/08/2009';'26/08/2009';'27/08/2009';'28/08/2009';'31/08/2009';'01/09/2009';
    '02/09/2009';'03/09/2009';'04/09/2009';'07/09/2009';'08/09/2009';'09/09/2009';
    '10/09/2009';'11/09/2009';'14/09/2009';'15/09/2009';'16/09/2009';'17/09/2009';
    '18/09/2009';'21/09/2009';'22/09/2009';'23/09/2009';'24/09/2009';'25/09/2009';
    '28/09/2009';'29/09/2009';'30/09/2009';'01/10/2009';'02/10/2009';'05/10/2009';
    '06/10/2009';'07/10/2009';'08/10/2009';'09/10/2009';'12/10/2009';'13/10/2009';
    '14/10/2009';'15/10/2009';'16/10/2009';'19/10/2009';'20/10/2009';'21/10/2009';
    '22/10/2009';'23/10/2009';'26/10/2009';'27/10/2009';'28/10/2009';'29/10/2009';
    '30/10/2009';'02/11/2009';'03/11/2009';'04/11/2009';'05/11/2009';'06/11/2009';
    '09/11/2009';'10/11/2009';'11/11/2009';'12/11/2009';'13/11/2009';'16/11/2009';
    '17/11/2009';'18/11/2009';'19/11/2009';'20/11/2009';'23/11/2009';'24/11/2009';
    '25/11/2009';'26/11/2009';'27/11/2009';'30/11/2009';'01/12/2009';'02/12/2009';
    '03/12/2009';'04/12/2009';'07/12/2009';'08/12/2009';'09/12/2009';'10/12/2009';
    '11/12/2009';'14/12/2009';'15/12/2009';'16/12/2009';'17/12/2009';'18/12/2009';
    '21/12/2009';'22/12/2009';'23/12/2009';'24/12/2009';'25/12/2009';'28/12/2009';
    '29/12/2009';'31/12/2009';'04/01/2010';'05/01/2010';'06/01/2010';'07/01/2010';
    '08/01/2010';'11/01/2010';'12/01/2010';'13/01/2010';'14/01/2010';'15/01/2010';
    '18/01/2010';'19/01/2010';'20/01/2010';'21/01/2010';'22/01/2010';'25/01/2010';
    '26/01/2010';'27/01/2010';'28/01/2010';'29/01/2010';'01/02/2010';'02/02/2010';
    '03/02/2010';'04/02/2010';'05/02/2010';'08/02/2010';'09/02/2010';'10/02/2010';
    '11/02/2010';'12/02/2010';'15/02/2010';'16/02/2010';'17/02/2010';'18/02/2010';
    '19/02/2010';'22/02/2010';'23/02/2010';'24/02/2010';'25/02/2010';'26/02/2010';
    '01/03/2010';'02/03/2010';'03/03/2010';'04/03/2010';'05/03/2010';'08/03/2010';
    '09/03/2010';'10/03/2010';'11/03/2010';'12/03/2010';'15/03/2010';'16/03/2010';
    '17/03/2010';'18/03/2010';'19/03/2010';'22/03/2010';'23/03/2010';'24/03/2010';
    '25/03/2010';'26/03/2010';'29/03/2010';'30/03/2010';'31/03/2010';'01/04/2010';
    '02/04/2010';'05/04/2010';'06/04/2010';'07/04/2010';'08/04/2010';'09/04/2010';
    '12/04/2010';'13/04/2010';'14/04/2010';'15/04/2010';'16/04/2010';'19/04/2010';
    '20/04/2010';'21/04/2010';'22/04/2010';'23/04/2010';'26/04/2010';'27/04/2010';
    '28/04/2010';'29/04/2010';'30/04/2010';'03/05/2010';'04/05/2010';'05/05/2010';
    '06/05/2010';'07/05/2010';'10/05/2010';'11/05/2010';'12/05/2010';'13/05/2010';
    '14/05/2010';'17/05/2010';};
k = 5;
alpha = 3;
gamma = 0.02;

% OUTPUTS;
xr_test = [0.362000000000000;0.380000000000000;0.316000000000000;0.343000000000000;0.318000000000000;
    0.328000000000000;0.287000000000000;0.264000000000000;0.249000000000000;0.213000000000000;
    0.163000000000000;0.146000000000000;0.198000000000000;0.115000000000000;0.108000000000000;
    0.140000000000000;0.154000000000000;0.119000000000000;0.189000000000000;0.250000000000000;
    0.250000000000000;0.357000000000000;0.388000000000000;0.300000000000000;0.273000000000000;
    0.269000000000000;0.247000000000000;0.244000000000000;0.257000000000000;0.213000000000000;
    0.220000000000000;0.170000000000000;0.194000000000000;0.271000000000000;0.238000000000000;
    0.216000000000000;0.216000000000000;0.216000000000000;0.261000000000000;0.287000000000000;
    0.267000000000000;0.267000000000000;0.311000000000000;0.299000000000000;0.328000000000000;
    0.348000000000000;0.396000000000000;0.425000000000000;0.462000000000000;0.462000000000000;
    0.571000000000000;0.571000000000000;0.700000000000000;0.716000000000000;0.875000000000000;
    0.947000000000000;1.10500000000000;1.05000000000000;0.953000000000000;0.943000000000000;
    0.938000000000000;0.849000000000000;0.901000000000000;0.885000000000000;0.862000000000000;
    0.788000000000000;0.758000000000000;0.759000000000000;0.726000000000000;0.776000000000000;
    0.776000000000000;0.926000000000000;1.02200000000000;1.14700000000000;1.23300000000000;
    1.17100000000000;1.02800000000000;1.02700000000000;1.03600000000000;1.18400000000000;
    1.12200000000000;1.31100000000000;1.32100000000000;1.32400000000000;1.30300000000000;
    1.28300000000000;1.28400000000000;1.35000000000000;1.36900000000000;1.34500000000000;
    1.24600000000000;1.26300000000000;1.21300000000000;1.16400000000000;1.16100000000000;
    1.13900000000000;1.15600000000000;1.06500000000000;1.03400000000000;1.04400000000000;
    1.02800000000000;1.00700000000000;1.03400000000000;1.03400000000000;1.12400000000000;
    1.11300000000000;1.07000000000000;0.987000000000000;0.919000000000000;0.958000000000000;
    0.985000000000000;0.963000000000000;0.963000000000000;0.963000000000000;0.979000000000000;
    0.993000000000000;0.999000000000000;0.976000000000000;1.00300000000000;1.02200000000000;
    1.01600000000000;1.01600000000000;0.916000000000000;0.934000000000000;0.948000000000000;
    0.924000000000000;0.889000000000000;0.870000000000000;0.870000000000000;0.754000000000000;
    0.717000000000000;0.632000000000000;0.587000000000000;0.636000000000000;0.690000000000000;
    0.767000000000000;0.779000000000000;0.645000000000000;0.701000000000000;0.677000000000000;
    0.643000000000000;0.685000000000000;0.745000000000000;0.679000000000000;0.741000000000000;
    0.697000000000000;0.690000000000000;0.696000000000000;0.689000000000000;0.681000000000000;
    0.681000000000000;0.744000000000000;0.738000000000000;0.775000000000000;0.808000000000000;
    0.788000000000000;0.737000000000000;0.724000000000000;0.740000000000000;0.738000000000000;
    0.728000000000000;0.722000000000000;0.729000000000000;0.747000000000000;0.746000000000000;
    0.739000000000000;0.775000000000000;0.781000000000000;0.777000000000000;0.774000000000000;
    0.764000000000000;0.766000000000000;0.759000000000000;0.769000000000000;0.759000000000000;
    0.792000000000000;0.750000000000000;0.759000000000000;0.752000000000000;0.722000000000000;
    0.697000000000000;0.686000000000000;0.715000000000000;0.715000000000000;0.609000000000000;
    0.561000000000000;0.556000000000000;0.499000000000000;0.468000000000000;0.481000000000000;
    0.429000000000000;0.436000000000000;0.443000000000000;0.433000000000000;0.409000000000000;
    0.401000000000000;0.440000000000000;0.406000000000000;0.389000000000000;0.409000000000000;
    0.458000000000000;0.432000000000000;0.482000000000000;0.478000000000000;0.436000000000000;
    0.461000000000000;0.459000000000000;0.433000000000000;0.431000000000000;0.447000000000000;
    0.461000000000000;0.432000000000000;0.482000000000000;0.477000000000000;0.519000000000000;
    0.563000000000000;0.576000000000000;0.566000000000000;0.575000000000000;0.546000000000000;
    0.546000000000000;0.489000000000000;0.485000000000000;0.475000000000000;0.462000000000000;
    0.438000000000000;0.449000000000000;0.410000000000000;0.457000000000000;0.433000000000000;
    0.434000000000000;0.408000000000000;0.405000000000000;0.436000000000000;0.423000000000000;
    0.469000000000000;0.513000000000000;0.491000000000000;0.468000000000000;0.440000000000000;
    0.463000000000000;0.459000000000000;0.452000000000000;0.466000000000000;0.479000000000000;
    0.460000000000000;0.480000000000000;0.431000000000000;0.419000000000000;0.401000000000000;
    0.351000000000000;0.335000000000000;0.358000000000000;0.348000000000000;0.362000000000000;
    0.358000000000000;0.366000000000000;0.358000000000000;0.342000000000000;0.312000000000000;
    0.314000000000000;0.312000000000000;0.328000000000000;0.326000000000000;0.339000000000000;
    0.322000000000000;0.319000000000000;0.331000000000000;0.348000000000000;0.361000000000000;
    0.360000000000000;0.360000000000000;0.395000000000000;0.403000000000000;0.406000000000000;
    0.404000000000000;0.445000000000000;0.441000000000000;0.412000000000000;0.413000000000000;
    0.386000000000000;0.412000000000000;0.357000000000000;0.420000000000000;0.470000000000000;
    0.470000000000000;0.561000000000000;0.522000000000000;0.502000000000000;0.514000000000000;
    0.491000000000000;0.553000000000000;0.553000000000000;0.618000000000000;0.575000000000000;
    0.547000000000000;0.547000000000000;0.547000000000000;0.547000000000000;0.517000000000000;
    0.552000000000000;0.581000000000000;0.582000000000000;0.593000000000000;0.593000000000000;
    0.579000000000000;0.598000000000000;0.613000000000000;0.613000000000000;0.689000000000000;
    0.771000000000000;0.829000000000000;0.822000000000000;0.951000000000000;0.914000000000000;
    0.930000000000000;0.843000000000000;0.806000000000000;0.892000000000000;0.892000000000000;
    1.10100000000000;1.05700000000000;1.15300000000000;1.33100000000000;1.44500000000000;
    1.44500000000000;1.47100000000000;1.26200000000000;1.16200000000000;1.09000000000000;
    1.10600000000000;1.12000000000000;1.09900000000000;1.09700000000000;1.08400000000000;
    1.08400000000000;1.04100000000000;1.11500000000000;1.11500000000000;1.16600000000000;
    1.11400000000000;1.01400000000000;0.935000000000000;0.885000000000000;0.948000000000000;
    0.937000000000000;0.926000000000000;0.971000000000000;0.880000000000000;0.871000000000000;
    0.857000000000000;0.889000000000000;0.905000000000000;0.905000000000000;0.961000000000000;
    1.00700000000000;1.05800000000000;1.05700000000000;1.02700000000000;1.06000000000000;
    0.963000000000000;0.958000000000000;0.976000000000000;0.946000000000000;0.911000000000000;
    0.911000000000000;0.911000000000000;0.913000000000000;0.913000000000000;1.00100000000000;
    1.02200000000000;1.03000000000000;1.07200000000000;1.13000000000000;1.09700000000000;
    1.21200000000000;1.21200000000000;1.32700000000000;1.41500000000000;1.41500000000000;
    1.65400000000000;1.68900000000000;1.68900000000000;2.26400000000000;2.05900000000000;
    1.88600000000000;2.01100000000000;2.40000000000000;2.40000000000000;2.54100000000000;
    2.54100000000000;2.54100000000000;1.57100000000000;1.40400000000000;1.46300000000000;
    1.62000000000000;1.61600000000000;];
score_test = [NaN;NaN;NaN;NaN;NaN;-0.0158000000000000;-0.0500000000000000;-0.0544000000000000;
    -0.0590000000000000;-0.0762000000000000;-0.105200000000000;-0.0892000000000000;
    -0.00899999999999998;-0.0788000000000000;-0.0590000000000000;-0.00599999999999998;
    0.0126000000000000;-0.0240000000000000;0.0618000000000000;0.108000000000000;
    0.227600000000000;0.164600000000000;0.155000000000000;0.0131999999999999;
    -0.0360000000000000;-0.0446000000000000;-0.0704000000000000;-0.0514000000000000;
    -0.00960000000000000;-0.0450000000000000;-0.0260000000000000;-0.0662000000000000;
    -0.0268000000000000;0.0602000000000000;0.0244000000000000;-0.00259999999999999;
    -0.00180000000000000;-0.0110000000000000;0.0296000000000000;0.0576000000000000;
    0.0278000000000000;0.0176000000000000;0.0514000000000000;0.0204000000000000;
    0.0418000000000000;0.0536000000000000;0.0854000000000000;0.0886000000000000;
    0.102800000000000;0.203200000000000;0.152400000000000;0.222800000000000;
    0.201800000000000;0.162800000000000;0.271000000000000;0.260400000000000;
    0.343200000000000;0.181400000000000;0.0144000000000001;-0.0430000000000002;
    -0.0616000000000001;-0.148800000000000;-0.0456000000000001;-0.0317999999999999;
    -0.0411999999999998;-0.0989999999999999;-0.0990000000000000;-0.0798000000000000;
    -0.0844000000000001;-0.00259999999999994;0.164600000000000;0.195000000000000;
    0.229400000000000;0.301800000000000;0.303600000000000;0.150200000000000;
    -0.0717999999999999;-0.0932000000000002;-0.0852000000000002;0.0850000000000002;
    0.0327999999999999;0.231600000000000;0.185000000000000;0.129200000000000;
    0.0506000000000000;0.00680000000000014;-0.0244000000000000;0.0470000000000002;
    0.0601999999999998;0.0271999999999999;-0.0802000000000001;-0.0558000000000001;
    -0.101600000000000;-0.123200000000000;-0.0851999999999999;-0.0704000000000000;
    -0.0320000000000003;-0.101600000000000;-0.103000000000000;-0.0669999999999997;
    -0.0596000000000001;-0.0584000000000000;-0.00160000000000005;0.0946000000000000;
    0.0886000000000002;0.0675999999999999;0.00760000000000027;-0.0880000000000000;
    -0.146600000000000;-0.0846000000000002;-0.0244000000000001;-0.0208000000000002;
    0.000600000000000045;0.00539999999999996;0.0126000000000001;0.0224000000000001;
    0.0268000000000000;-0.00339999999999985;0.0209999999999999;0.0320000000000000;
    0.0174000000000000;-0.0872000000000001;-0.0795999999999999;-0.0606000000000001;
    -0.0328000000000001;-0.0419999999999999;-0.0586000000000001;-0.0521999999999999;
    -0.159000000000000;-0.174200000000000;-0.144400000000000;-0.188000000000000;
    -0.181600000000000;-0.0760000000000001;0.0247999999999998;0.114600000000000;
    0.116600000000000;-0.0468000000000000;-0.00240000000000007;-0.0393999999999999;
    -0.0708000000000000;-0.00400000000000000;0.0747999999999999;-0.0112000000000000;
    0.0551999999999999;-0.00160000000000005;-0.0194000000000001;-0.0144000000000001;
    -0.0116000000000001;-0.0216000000000000;0.0533999999999999;0.104600000000000;
    0.0398000000000001;0.0684000000000000;0.0842000000000001;0.0387999999999999;
    -0.0336000000000002;-0.0452000000000000;-0.0264000000000002;-0.0214000000000001;
    -0.0174000000000000;-0.0114000000000000;-0.00139999999999996;0.0155999999999999;
    0.0132000000000001;0.00460000000000005;0.0384000000000001;0.0338000000000001;
    0.0194000000000001;0.0104000000000000;-0.00519999999999998;-0.00820000000000010;
    -0.0134000000000000;0.00100000000000000;-0.00740000000000007;0.0286000000000000;
    -0.0189999999999999;-0.00679999999999992;-0.0138000000000000;-0.0404000000000001;
    -0.0580000000000001;-0.0499999999999999;-0.00820000000000010;-0.105400000000000;
    -0.113000000000000;-0.123400000000000;-0.101200000000000;-0.132200000000000;
    -0.120000000000000;-0.0576000000000000;-0.0840000000000000;-0.0506000000000000;
    -0.0196000000000000;-0.0184000000000000;-0.0354000000000000;-0.0290000000000000;
    0.0156000000000000;-0.0191999999999999;-0.0288000000000000;0;0.0490000000000000;
    0.0115999999999999;0.0632000000000000;0.0440000000000000;-0.0158000000000000;
    0.00380000000000003;0.00120000000000009;-0.0302000000000000;-0.0224000000000000;
    0.00299999999999995;0.0148000000000000;-0.0142000000000000;0.0412000000000000;
    0.0264000000000000;0.0592000000000000;0.0887999999999999;0.0814000000000000;
    0.0426000000000000;0.0348000000000001;-0.0137999999999998;-0.0761999999999999;
    -0.105800000000000;-0.0594000000000000;-0.0532000000000000;-0.0462000000000000;
    -0.0534000000000001;-0.0207999999999999;-0.0518000000000000;0.0102000000000000;
    -0.0101999999999999;-0.00339999999999996;-0.0286000000000001;-0.0234000000000000;
    0.00860000000000000;-0.000200000000000033;0.0478000000000000;0.0848000000000000;
    0.0418000000000000;0.00160000000000005;-0.0328000000000000;-0.0131999999999999;
    -0.0160000000000000;-0.0122000000000000;0.00960000000000000;0.0229999999999999;
    -0.00379999999999997;0.0168000000000000;-0.0363999999999999;-0.0442000000000000;
    -0.0528000000000000;-0.0872000000000000;-0.0814000000000000;-0.0294000000000000;
    -0.0248000000000000;0.00340000000000007;0.00719999999999998;0.0138000000000000;
    -0.000400000000000067;-0.0164000000000000;-0.0452000000000000;-0.0332000000000000;
    -0.0264000000000000;0.000400000000000011;0.00440000000000002;0.0206000000000000;
    -0.00179999999999997;-0.00640000000000002;0.00419999999999998;0.0206000000000000;
    0.0292000000000000;0.0238000000000000;0.0822000000000000;0.0430000000000000;
    0.0382000000000001;0.0302000000000000;0.0192000000000001;0.0514000000000000;
    0.0304000000000000;-0.00780000000000009;-0.00860000000000005;-0.0369999999999999;
    -0.00740000000000002;-0.0558000000000000;0.0240000000000000;0.0724000000000000;
    0.152000000000000;0.135200000000000;0.0664000000000000;0.0134000000000001;
    0.00900000000000012;-0.0228000000000000;0.0350000000000000;0.101600000000000;
    0.125400000000000;0.0292000000000000;-0.0110000000000000;-0.0222000000000001;
    -0.0210000000000000;-0.0198000000000000;-0.0356000000000001;0.0110000000000000;
    0.0389999999999999;0.0331999999999999;0.0372000000000000;0.0280000000000000;
    -0.00119999999999998;0.0124000000000000;0.0240000000000001;0.0938000000000000;
    0.171800000000000;0.190600000000000;0.172200000000000;0.119000000000000;
    0.206200000000000;0.101600000000000;0.0726000000000001;-0.0462000000000000;
    -0.0860000000000000;0.00319999999999998;0.224000000000000;0.189400000000000;
    0.150200000000000;0.203400000000000;0.312000000000000;0.338200000000000;
    0.227600000000000;0.184800000000000;-0.107000000000000;-0.228800000000000;
    -0.267000000000000;-0.180000000000000;-0.0981999999999998;-0.0490000000000002;
    -0.0184000000000000;-0.0184000000000000;-0.0702000000000000;-0.0558000000000001;
    0.0340000000000000;0.0307999999999999;0.0781999999999998;0.00980000000000003;
    -0.0961999999999998;-0.169800000000000;-0.183800000000000;-0.0748000000000002;
    -0.0422000000000001;-0.0178000000000000;0.0448000000000000;-0.0534000000000000;
    -0.0614000000000000;-0.0600000000000001;-0.0120000000000000;0.0114000000000001;
    0.0805999999999999;0.0755999999999999;0.103600000000000;0.124600000000000;
    0.0898000000000001;0.0294000000000000;0.0380000000000000;-0.0787999999999999;
    -0.0750000000000000;-0.0369999999999999;-0.0508000000000001;-0.0695999999999999;
    -0.0397999999999998;-0.0294000000000000;-0.0180000000000000;0.0826000000000000;
    0.148200000000000;0.0921999999999998;0.0780000000000001;0.0962000000000000;
    0.122400000000000;0.0460000000000000;0.141800000000000;0.228800000000000;
    0.182400000000000;0.219400000000000;0.401400000000000;0.372800000000000;
    0.284400000000000;0.764000000000000;0.859600000000000;0.316800000000000;
    0.0149999999999999;0.0936000000000001;0.418200000000000;0.658000000000000;
    0.389800000000000;0.293400000000000;-0.807600000000000;-1.01460000000000;
    -0.914800000000000;-0.656600000000000;-0.284000000000000;-0.103800000000000;];
Dstat_test = 0.00228134229810974;
outlier_test = {'03/12/2008','Series1';'13/01/2009','Series1';'15/01/2009','Series1';
    '11/02/2009','Series1';'12/02/2009','Series1';'30/03/2009','Series1';
    '31/03/2009','Series1';'23/04/2009','Series1';'24/04/2009','Series1';
    '04/05/2009','Series1';'05/05/2009','Series1';'03/06/2009','Series1';
    '04/06/2009','Series1';'20/07/2009','Series1';'21/07/2009','Series1';
    '09/09/2009','Series1';'10/09/2009','Series1';'19/11/2009','Series1';
    '09/12/2009','Series1';'18/12/2009','Series1';'21/12/2009','Series1';
    '13/01/2010','Series1';'14/01/2010','Series1';'15/01/2010','Series1';
    '28/01/2010','Series1';'29/01/2010','Series1';'19/02/2010','Series1';
    '17/03/2010','Series1';'07/04/2010','Series1';'08/04/2010','Series1';
    '19/04/2010','Series1';'22/04/2010','Series1';'23/04/2010','Series1';
    '27/04/2010','Series1';'28/04/2010','Series1';'05/05/2010','Series1';
    '10/05/2010','Series1';'11/05/2010','Series1';};
outlier_num_test = [21,1;50,1;52,1;71,1;72,1;104,1;105,1;122,1;123,1;129,1;130,1;
    151,1;152,1;184,1;185,1;221,1;222,1;272,1;286,1;293,1;294,1;309,1;310,1;
    311,1;320,1;321,1;336,1;354,1;369,1;370,1;377,1;380,1;381,1;383,1;384,1;
    389,1;392,1;393,1;];


[n, c] = size(x);
xr = x;

score = nan(n,c);
mov_mean = nan(n,c);
mov_std = nan(n,c);
outlier_mat = zeros(n,c);
d = zeros(n,c);

for i = k+1:n
    mov_mean(i,:) = mean(xr(i-k:i-1,:));
    score(i,:) = xr(i,:) - mov_mean(i,:);
    mov_std(i,:) = std(xr(i-k:i-1,:));
    temp = abs(score(i,:)) > (alpha .* mov_std(i,:) + gamma);
    xr(i,temp) = x(i-1,temp);
    outlier_mat(i,:) = temp*1;
    temp1 = xr(i,:) >= (x(i,:) + mov_std(i,:));
    temp2 = xr(i,:) < (x(i,:) - mov_std(i,:));
    d(i,temp1)= xr(i,temp1)-(x(i,temp1)+mov_std(i,temp1));
    d(i,temp2)= (x(i,temp2)-mov_std(i,temp2))-xr(i,temp2);
end
Dstat = mean(d.^2);

[i1,j1] = find(outlier_mat);
if ~isempty(i1),
    outlier = [x_date(i1) cellstr(strcat('Series', num2str(j1)))];
    outlier_num = [i1 j1];
else
    outlier = ('No outliers have been identified!');
    outlier_num = ('No outliers have been identified!');
end

if isequal(round(xr_test.*10^5)./10^5, round(xr.*10^5)./10^5) && ...
        isequal(round(score_test(k+1:end).*10^5)./10^5, round(score(k+1:end).*10^5)./10^5) && ...
        isequal(round(Dstat_test.*10^5)./10^5, round(Dstat.*10^5)./10^5) && ...
        isequal(outlier_test, outlier) && isequal(outlier_num_test, outlier_num),
    disp('All tests have passed.');
else
    disp('There is some error in the cash output. Please do not use the function.');
end

